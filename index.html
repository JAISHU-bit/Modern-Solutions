<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Teen Car Savings & Investing Planner</title>
    <style>
        :root {
            --bg: #0b1220; --card: #111a2b; --muted: #91a2c7; --text: #eaf1ff; --accent: #6ea8fe; --accent2: #7ee7c4; --warn: #ffd166; --danger: #ef4444;
        }
        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial; background: linear-gradient(180deg, #0a1020, #09101d 30%, #0b1220); color: var(--text); }
        .container { max-width: 1100px; margin: 24px auto; padding: 16px; }
        h1 { font-size: 28px; margin: 0 0 12px 0; }
        .sub { color: var(--muted); margin-bottom: 18px; }
        .grid { display: grid; grid-template-columns: 1.1fr 1fr; gap: 16px; }
        .card { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; padding: 14px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25); }
        .card h2 { font-size: 18px; margin: 0 0 10px; }
        label { display: block; font-size: 12px; color: var(--muted); margin-top: 10px; }
        input, select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.08); background: #0c1628; color: var(--text); }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .numbers { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .kpi { background: #0c1628; border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 14px; padding: 12px; }
        .kpi .label { font-size: 12px; color: var(--muted); }
        .kpi .value { font-size: 22px; font-weight: 700; margin-top: 4px; }
        .actions { display: flex; gap: 10px; margin-top: 10px; }
        button { cursor: pointer; border: none; border-radius: 12px; padding: 10px 14px; font-weight: 600; }
        .primary { background: var(--accent); color: #071022; }
        .ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.15); color: var(--text); }
        .note { font-size: 12px; color: var(--muted); margin-top: 8px; }
        .footer { opacity: .8; font-size: 12px; margin-top: 14px; color: var(--muted); }
        canvas { width: 100%; height: 260px; background: #0b1426; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.06); }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th, td { padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.08); }
        th { color: var(--muted); text-align: left; }
        .pill { display: inline-block; padding: 4px 8px; border-radius: 999px; background: rgba(110, 168, 254, .15); color: var(--accent); font-weight: 600; font-size: 11px; margin-left: 6px; }
        .warn { background: rgba(255, 209, 102, .12); color: var(--warn); }
        .danger { background: rgba(239, 68, 68, .12); color: var(--danger); }
        .toggle-container { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .toggle { position: relative; display: inline-block; width: 44px; height: 24px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #4a5568; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(20px); }
        .progress-bar-container { background: rgba(0,0,0,0.2); border-radius: 8px; overflow: hidden; height: 16px; margin-top: 10px; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #6ea8fe, #7ee7c4); transition: width 0.5s ease-in-out; }
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teen Car Savings & Investing Planner <span class="pill">Age 14 → 18</span></h1>
        <div class="sub">Plan a safe <strong>Car Fund</strong> and an invested <strong>Future Fund</strong> side‑by‑side.</div>

        <div class="grid">
            <section class="card" aria-label="Inputs">
                <h2>Inputs</h2>
                <div class="row">
                    <div>
                        <label>Current age</label>
                        <input id="ageNow" type="number" min="10" max="17" value="14">
                    </div>
                    <div>
                        <label>Goal age</label>
                        <input id="ageGoal" type="number" min="16" max="20" value="18">
                    </div>
                </div>
                
                <h3 style="font-size:16px;margin-top:16px;margin-bottom:8px;">Income & Savings</h3>
                <div class="row">
                    <div>
                        <label>Starting amount ($)</label>
                        <input id="startAmount" type="number" min="0" step="1" value="100">
                    </div>
                    <div>
                        <label>Monthly save now ($)</label>
                        <input id="monthlyNow" type="number" min="0" step="1" value="20">
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label>Job start age</label>
                        <input id="jobStartAge" type="number" min="14" max="18" value="16">
                    </div>
                    <div>
                        <label>Hourly wage ($/hr)</label>
                        <input id="wage" type="number" min="0" step="0.25" value="15">
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label>Hours per week</label>
                        <input id="hoursWeek" type="number" min="0" step="1" value="10">
                    </div>
                    <div>
                        <label>Tax rate (%) <span class="note">(simplified)</span></label>
                        <input id="taxRate" type="number" min="0" max="50" step="1" value="15">
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label>Save rate from job (%)</label>
                        <input id="saveRate" type="number" min="0" max="100" step="1" value="50">
                    </div>
                    <div>
                        <label>Target Car Price ($)</label>
                        <input id="carPrice" type="number" min="0" step="100" value="5000">
                    </div>
                </div>

                <h3 style="font-size:16px;margin-top:16px;margin-bottom:8px;">Goals & Investments</h3>
                <div class="row">
                    <div>
                        <label>Split to Car Fund (%)</label>
                        <input id="carSplit" type="number" min="0" max="100" step="1" value="70">
                    </div>
                    <div>
                        <label>Split to Future Fund (%)</label>
                        <input id="futureSplit" type="number" min="0" max="100" step="1" value="30" disabled>
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label>Car Fund APY (%/yr)</label>
                        <input id="carAPY" type="number" min="0" step="0.1" value="4.5">
                    </div>
                    <div>
                        <label>Future Fund return range (%/yr)</label>
                        <input id="futureAPY" type="text" value="5, 10">
                        <span class="note">(e.g., "5, 10" for a range)</span>
                    </div>
                </div>

                <div class="toggle-container">
                    <label style="margin-top:0">Enable Parent Match?</label>
                    <label class="toggle">
                        <input type="checkbox" id="parentMatchToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div id="parentMatchInput" style="display:none;margin-top:10px">
                    <label>Match rate (%) <span class="note">(of saved amount)</span></label>
                    <input id="parentMatchRate" type="number" min="0" step="1" value="50">
                </div>

                <div class="actions">
                    <button class="primary" id="runBtn">Run Plan</button>
                    <button class="ghost" id="resetBtn">Reset</button>
                </div>
                <div class="note">Monthly job income uses `hours/week × 4.33`. Compounding is monthly.</div>
            </section>

            <section class="card" aria-label="Key results">
                <h2>By your goal age</h2>
                <div class="numbers">
                    <div class="kpi">
                        <div class="label">Car Fund (safe)</div>
                        <div class="value" id="kpiCar">$0</div>
                    </div>
                    <div class="kpi">
                        <div class="label">Future Fund (invested)</div>
                        <div class="value" id="kpiFuture">$0</div>
                    </div>
                    <div class="kpi">
                        <div class="label">Total</div>
                        <div class="value" id="kpiTotal">$0</div>
                    </div>
                </div>
                <div class="numbers" style="margin-top:10px">
                    <div class="kpi">
                        <div class="label">Total Contributions</div>
                        <div class="value" id="kpiContrib">$0</div>
                    </div>
                    <div class="kpi">
                        <div class="label">Growth (min)</div>
                        <div class="value" id="kpiGrowthMin">$0</div>
                    </div>
                    <div class="kpi">
                        <div class="label">Growth (max)</div>
                        <div class="value" id="kpiGrowthMax">$0</div>
                    </div>
                </div>
                <div class="kpi" style="margin-top:10px; text-align:center;">
                    <div class="label">Car Goal Progress</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="carProgressBar"></div>
                    </div>
                    <div class="value" id="carProgressPct" style="font-size:16px; margin-top:6px;">0%</div>
                </div>

                <div class="note warn" id="riskNote" style="display:none;margin-top:10px;padding:8px;border-radius:10px">Reminder: The Future Fund amount is an estimate. It could be lower or higher based on market performance.</div>
                <div class="note danger" id="carWarning" style="display:none;margin-top:10px;padding:8px;border-radius:10px">The Car Fund may not reach your target price of <span id="carPriceWarning"></span>. Consider saving more or adjusting your goal.</div>
            </section>
        </div>

        <div class="card" style="margin-top:16px">
            <h2>Balance over time</h2>
            <canvas id="chart" width="1000" height="260" aria-label="Balance chart"></canvas>
            <div class="note">Line = Total; shaded areas show Car vs Future fund balances. The range shows the possible outcome of the Future Fund.</div>
        </div>

        <div class="card" style="margin-top:16px">
            <h2>Month‑by‑Month Detail</h2>
            <div style="overflow:auto; max-height:320px; border:1px solid rgba(255,255,255,0.06); border-radius:12px;">
                <table id="table"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <div class="footer">Made for learning. Returns are estimates, not guarantees. Consider keeping short‑term car money safe in a HYSA or CD.</div>
    </div>

    <script>
        const $ = (id) => document.getElementById(id);

        function currency(n) { return n.toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }); }
        
        function run() {
            const ageNow = +$("ageNow").value;
            const ageGoal = +$("ageGoal").value;
            const months = Math.max(0, Math.round((ageGoal - ageNow) * 12));
            const startAmount = +$("startAmount").value;
            const monthlyNow = +$("monthlyNow").value;
            const jobStartAge = +$("jobStartAge").value;
            const wage = +$("wage").value;
            const hoursWeek = +$("hoursWeek").value;
            const taxRate = +$("taxRate").value / 100;
            const saveRate = +$("saveRate").value / 100;
            const carSplit = +$("carSplit").value / 100;
            const futureSplit = 1 - carSplit;
            $("futureSplit").value = Math.round(futureSplit * 100);
            const carAPY = +$("carAPY").value / 100;
            const carPrice = +$("carPrice").value;
            const [futureAPY_min, futureAPY_max] = $("futureAPY").value.split(',').map(s => (+s) / 100);
            const parentMatchEnabled = $("parentMatchToggle").checked;
            const parentMatchRate = +$("parentMatchRate").value / 100;

            const rCar = carAPY / 12; // monthly
            const rFuture_min = futureAPY_min / 12;
            const rFuture_max = futureAPY_max / 12;

            let carBal = 0, futureBal_min = 0, futureBal_max = 0;
            let totalContrib = 0;
            const rows = [];

            carBal += startAmount; totalContrib += startAmount;

            for (let m = 0; m < months; m++) {
                const age = ageNow + m / 12;
                let jobIncome = 0;
                let jobSaved = 0;
                let parentMatch = 0;
                
                if (age >= jobStartAge) {
                    const monthlyGross = wage * hoursWeek * 4.33;
                    const taxPaid = monthlyGross * taxRate;
                    jobIncome = monthlyGross - taxPaid;
                    jobSaved = jobIncome * saveRate;
                    if (parentMatchEnabled) {
                        parentMatch = jobSaved * parentMatchRate;
                    }
                }
                const monthContrib = monthlyNow + jobSaved + parentMatch;
                totalContrib += monthContrib;
                
                const toCar = monthContrib * carSplit;
                const toFuture = monthContrib * futureSplit;
                
                carBal = carBal * (1 + rCar) + toCar;
                futureBal_min = futureBal_min * (1 + rFuture_min) + toFuture;
                futureBal_max = futureBal_max * (1 + rFuture_max) + toFuture;

                rows.push({
                    month: m + 1,
                    age: age,
                    job_income: jobIncome,
                    saved_from_job: jobSaved,
                    to_car: toCar,
                    to_future: toFuture,
                    parent_match: parentMatch,
                    car_balance: carBal,
                    future_balance_min: futureBal_min,
                    future_balance_max: futureBal_max,
                    total_balance_min: carBal + futureBal_min,
                    total_balance_max: carBal + futureBal_max
                });
            }

            const finalCarBal = carBal;
            const finalFutureBalMin = futureBal_min;
            const finalFutureBalMax = futureBal_max;
            const finalTotalMin = finalCarBal + finalFutureBalMin;
            const finalTotalMax = finalCarBal + finalFutureBalMax;
            
            const growthMin = Math.max(0, finalTotalMin - totalContrib);
            const growthMax = Math.max(0, finalTotalMax - totalContrib);
            const carProgress = Math.min(100, (finalCarBal / carPrice) * 100);

            $("kpiCar").textContent = currency(finalCarBal);
            $("kpiFuture").textContent = `${currency(finalFutureBalMin)} - ${currency(finalFutureBalMax)}`;
            $("kpiTotal").textContent = `${currency(finalTotalMin)} - ${currency(finalTotalMax)}`;
            $("kpiContrib").textContent = currency(totalContrib);
            $("kpiGrowthMin").textContent = currency(growthMin);
            $("kpiGrowthMax").textContent = currency(growthMax);
            $("carProgressBar").style.width = `${carProgress}%`;
            $("carProgressPct").textContent = `${carProgress.toFixed(0)}%`;

            $("riskNote").style.display = futureAPY_max > 0 && futureSplit > 0 ? 'block' : 'none';
            if (carPrice > 0 && finalCarBal < carPrice) {
                $("carWarning").style.display = 'block';
                $("carPriceWarning").textContent = currency(carPrice);
            } else {
                $("carWarning").style.display = 'none';
            }

            drawChart(rows, carBal, futureBal_min, futureBal_max);
            fillTable(rows);
        }

        function drawChart(rows, finalCarBal, finalFutureBalMin, finalFutureBalMax) {
            const c = $("chart");
            const ctx = c.getContext('2d');
            ctx.clearRect(0, 0, c.width, c.height);

            const P = { l: 48, r: 12, t: 14, b: 28 };
            const W = c.width - P.l - P.r;
            const H = c.height - P.t - P.b;
            const xs = (i) => P.l + (i / (Math.max(1, rows.length - 1))) * W;
            const maxY = Math.max(1000, finalCarBal + finalFutureBalMax, ...rows.map(r => r.total_balance_max));
            const ys = (v) => P.t + H - (v / maxY) * H;
            
            ctx.strokeStyle = 'rgba(255,255,255,0.08)';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 6]);
            for (let g = 0; g <= 5; g++) {
                const y = P.t + (H / 5) * g;
                ctx.beginPath(); ctx.moveTo(P.l, y); ctx.lineTo(P.l + W, y); ctx.stroke();
                const val = Math.round((1 - g / 5) * maxY);
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = '12px system-ui, -apple-system, Segoe UI';
                ctx.fillText(currency(val), 6, y + 4);
            }
            ctx.setLineDash([]);

            // Draw Future Fund range area
            ctx.beginPath();
            rows.forEach((r, i) => { const x = xs(i), y = ys(r.car_balance + r.future_balance_min); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); });
            for (let i = rows.length - 1; i >= 0; i--) { const r = rows[i]; const x = xs(i), y = ys(r.car_balance + r.future_balance_max); ctx.lineTo(x, y); }
            ctx.closePath();
            ctx.fillStyle = 'rgba(126,231,196,0.18)'; ctx.fill();

            // Draw Car Fund Area
            ctx.beginPath();
            rows.forEach((r, i) => { const x = xs(i), y = ys(r.car_balance); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); });
            ctx.lineTo(P.l + W, ys(0));
            ctx.closePath();
            ctx.fillStyle = 'rgba(110,168,254,0.20)'; ctx.fill();

            // Total min and max lines
            ctx.beginPath();
            rows.forEach((r, i) => { const x = xs(i), y = ys(r.total_balance_max); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); });
            ctx.strokeStyle = '#7ee7c4'; ctx.lineWidth = 2; ctx.stroke();
            
            ctx.beginPath();
            rows.forEach((r, i) => { const x = xs(i), y = ys(r.total_balance_min); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); });
            ctx.strokeStyle = '#7ee7c4'; ctx.lineWidth = 1; ctx.setLineDash([4, 2]); ctx.stroke();
            ctx.setLineDash([]);
            
            // Car Fund Line
            ctx.beginPath();
            rows.forEach((r, i) => { const x = xs(i), y = ys(r.car_balance); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); });
            ctx.strokeStyle = '#6ea8fe'; ctx.lineWidth = 2; ctx.stroke();

            // Legend
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.font = '12px system-ui, -apple-system, Segoe UI';
            ctx.fillText('Car Fund (Safe)', P.l + 8, P.t + 16);
            ctx.fillText('Future Fund (Range)', P.l + 118, P.t + 16);
            ctx.fillText('Total Balance', P.l + 258, P.t + 16);
            // Legend markers
            ctx.fillStyle = 'rgba(110,168,254,0.6)'; ctx.fillRect(P.l - 2, P.t + 6, 10, 10);
            ctx.fillStyle = 'rgba(126,231,196,0.6)'; ctx.fillRect(P.l + 108, P.t + 6, 10, 10);
            ctx.fillStyle = '#7ee7c4'; ctx.fillRect(P.l + 236, P.t + 6, 10, 10);
        }

        function fillTable(rows) {
            const thead = $("table").querySelector('thead');
            const tbody = $("table").querySelector('tbody');
            thead.innerHTML = `<tr>
                <th>#</th>
                <th>Age</th>
                <th>Saved from job</th>
                <th>To Car</th>
                <th>To Future</th>
                <th>Parent Match</th>
                <th>Car balance</th>
                <th>Future balance (range)</th>
                <th>Total (range)</th>
            </tr>`;
            tbody.innerHTML = rows.map(r => `<tr>
                <td>${r.month}</td>
                <td>${(r.age).toFixed(1)}</td>
                <td>${currency(r.saved_from_job)}</td>
                <td>${currency(r.to_car)}</td>
                <td>${currency(r.to_future)}</td>
                <td>${currency(r.parent_match)}</td>
                <td>${currency(r.car_balance)}</td>
                <td>${currency(r.future_balance_min)} - ${currency(r.future_balance_max)}</td>
                <td>${currency(r.total_balance_min)} - ${currency(r.total_balance_max)}</td>
            </tr>`).join('');
        }
        
        // Events
        $("runBtn").addEventListener('click', run);
        $("resetBtn").addEventListener('click', () => {
            $("ageNow").value = 14; $("ageGoal").value = 18; $("startAmount").value = 100; $("monthlyNow").value = 20;
            $("jobStartAge").value = 16; $("wage").value = 15; $("hoursWeek").value = 10; $("taxRate").value = 15;
            $("saveRate").value = 50; $("carPrice").value = 5000; $("carSplit").value = 70; $("futureSplit").value = 30; 
            $("carAPY").value = 4.5; $("futureAPY").value = '5, 10';
            $("parentMatchToggle").checked = false;
            $("parentMatchInput").style.display = 'none';
            run();
        });
        $("carSplit").addEventListener('input', () => { $("futureSplit").value = 100 - (+$("carSplit").value || 0); });
        $("parentMatchToggle").addEventListener('change', (e) => { $("parentMatchInput").style.display = e.target.checked ? 'block' : 'none'; });

        run();
    </script>
</body>
</html>
